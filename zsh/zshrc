# Path to your oh-my-zsh installation.
export ZSH=$HOME/.oh-my-zsh

# Set name of the theme to load.  Look in $HOME/.oh-my-zsh/themes/
# Optionally, if you set this to "random", it'll load a random theme each
# time that oh-my-zsh is loaded.
ZSH_THEME="geoffgarside"

# Preferred editor for local and remote sessions
command -v nvim > /dev/null && export EDITOR=nvim || export EDITOR=vim

# Plugins can be found in $HOME/.oh-my-zsh/plugins/*
# Custom plugins may be added to $HOME/.oh-my-zsh/custom/plugins/
# Add wisely, as too many plugins slow down shell startup.
plugins=(git autojump pip)

export DISABLE_UNTRACKED_FILES_DIRTY="true"

source $ZSH/oh-my-zsh.sh

# User Configuration
# ------------------

# enable shift+tab for going back in auto complete menu
bindkey '^[[Z' reverse-menu-complete
#
# use emacs key-bindings in shell
bindkey -e

# better settings for `less`
export LESS=-iXFR

# disable vim's r command so it doesn't interfere with R
disable r

# source my aliases
source $HOME/dotfiles/zsh/aliases.zsh
source $HOME/dotfiles/zsh/school.zsh

# automatically ls after cd
function chpwd() {
    emulate -L zsh
    ls
}

# configuring some environment variables
export DOTFILES_DIR=$HOME/dotfiles
export DATA_DIR=$DOTFILES_DIR/data
export BIN_DIR=$DOTFILES_DIR/bin

# configuring PATH
export PATH=$BIN_DIR:/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin:/opt/X11/bin:/Library/TeX/texbin:$HOME/.ssi/bin

export MANPATH="/usr/local/man:$MANPATH"

# platform-specific configs
PLATFORM_ZSH_CONFIG="$DOTFILES_DIR/zsh/`uname`.zsh"
[[ -f $PLATFORM_ZSH_CONFIG ]] && source $PLATFORM_ZSH_CONFIG
unset PLATFORM_ZSH_CONFIG

# pyenv startup and config
export PYENV_ROOT=$HOME/.pyenv
PYENV_INIT_SCRIPT=$DATA_DIR/cache/_pyenv_init_script
[[ ! -f $PYENV_INIT_SCRIPT ]] && pyenv init - > $PYENV_INIT_SCRIPT
source $PYENV_INIT_SCRIPT
unset PYENV_INIT_SCRIPT

# fzf config
[ -f ~/.fzf.zsh ] && source ~/.fzf.zsh
export FZF_DEFAULT_COMMAND="rg --hidden -g '!.git' -l ''"  # to find hidden files

# prevent Python from generating bytecode
export PYTHONDONTWRITEBYTECODE=1

# prevent Python from buffering stdout/stderr
export PYTHONUNBUFFERED=1

# nvm config
export NVM_DIR="$HOME/.nvm"
nvm() {
    unset -f nvm
    [ -s "/usr/local/opt/nvm/nvm.sh" ] && . "/usr/local/opt/nvm/nvm.sh"  # This loads nvm
    [ -s "/usr/local/opt/nvm/etc/bash_completion" ] && . "/usr/local/opt/nvm/etc/bash_completion"  # This loads nvm bash_completion
    nvm "$@"
}

node() {
    unset -f node
    [ -s "/usr/local/opt/nvm/nvm.sh" ] && . "/usr/local/opt/nvm/nvm.sh"  # This loads nvm
    [ -s "/usr/local/opt/nvm/etc/bash_completion" ] && . "/usr/local/opt/nvm/etc/bash_completion"  # This loads nvm bash_completion
    node "$@"
}

npm() {
    unset -f npm
    [ -s "/usr/local/opt/nvm/nvm.sh" ] && . "/usr/local/opt/nvm/nvm.sh"  # This loads nvm
    [ -s "/usr/local/opt/nvm/etc/bash_completion" ] && . "/usr/local/opt/nvm/etc/bash_completion"  # This loads nvm bash_completion
    npm "$@"
}

# enables zsh autocomplete when using invoke (make for Python)
source $DATA_DIR/pyinvoke_completions.zsh

# pipenv config
export PIPENV_VENV_IN_PROJECT=true

# pipenv auto-completion
PIPENV_COMPLETION_SCRIPT=$DATA_DIR/cache/_pipenv_completion_script
[[ ! -f $PIPENV_COMPLETION_SCRIPT ]] && pipenv --completion > $PIPENV_COMPLETION_SCRIPT
source $PIPENV_COMPLETION_SCRIPT
unset PIPENV_COMPLETION_SCRIPT

# holds passwords and API tokens that shouldn't be in source control
touch $DOTFILES_DIR/.secrets
source $DOTFILES_DIR/.secrets
